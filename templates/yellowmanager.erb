#! /bin/sh

#
# Helper script for checking and changing status of all Hadoop daemons
# relevant for this node.
#

if [ -z "$1" ]; then
	echo "Usage: $0 start|stop|status|..."
	echo "       $0 clean"
	exit 1
fi

while [ -n "$1" ]; do

	case "$1" in
	clean)
		rm -rfv /var/log/hadoop-*/* 2>/dev/null || :
		;;
	start|restart)
		<%if scope.lookupvar('hadoop::daemon_namenode') -%>echo "namenode $1"; service <%= scope.lookupvar('hadoop::daemons')['namenode'] -%> $1<%end%>
		<%if scope.lookupvar('hadoop::daemon_resourcemanager') -%>echo "resourcemanager $1"; service <%= scope.lookupvar('hadoop::daemons')['resourcemanager'] -%> $1&<%end%>
		<%if scope.lookupvar('hadoop::daemon_historyserver') -%>echo "historyserver $1"; service <%= scope.lookupvar('hadoop::daemons')['historyserver'] -%> $1&<%end%>
		<%if scope.lookupvar('hadoop::daemon_nodemanager') -%>echo "nodemanager $1"; service <%= scope.lookupvar('hadoop::daemons')['nodemanager'] -%> $1&<%end%>
		<%if scope.lookupvar('hadoop::daemon_datanode') -%>echo "datanode $1"; service <%= scope.lookupvar('hadoop::daemons')['datanode'] -%> $1&<%end%>
		wait
		;;
	stop)
		<%if scope.lookupvar('hadoop::daemon_resourcemanager') -%>echo "resourcemanager $1"; service <%= scope.lookupvar('hadoop::daemons')['resourcemanager'] -%> $1&<%end%>
		<%if scope.lookupvar('hadoop::daemon_historyserver') -%>echo "historyserver $1"; service <%= scope.lookupvar('hadoop::daemons')['historyserver'] -%> $1&<%end%>
		<%if scope.lookupvar('hadoop::daemon_nodemanager') -%>echo "nodemanager $1"; service <%= scope.lookupvar('hadoop::daemons')['nodemanager'] -%> $1&<%end%>
		<%if scope.lookupvar('hadoop::daemon_datanode') -%>echo "datanode $1"; service <%= scope.lookupvar('hadoop::daemons')['datanode'] -%> $1&<%end%>
		wait
		<%if scope.lookupvar('hadoop::daemon_namenode') -%>echo "namenode $1"; service <%= scope.lookupvar('hadoop::daemons')['namenode'] -%> $1<%end%>
		;;
	*)
		<%if scope.lookupvar('hadoop::daemon_namenode') -%>echo "namenode $1"; service <%= scope.lookupvar('hadoop::daemons')['namenode'] -%> $1<%end%>
		<%if scope.lookupvar('hadoop::daemon_resourcemanager') -%>echo "resourcemanager $1"; service <%= scope.lookupvar('hadoop::daemons')['resourcemanager'] -%> $1<%end%>
		<%if scope.lookupvar('hadoop::daemon_historyserver') -%>echo "historyserver $1"; service <%= scope.lookupvar('hadoop::daemons')['historyserver'] -%> $1<%end%>
		<%if scope.lookupvar('hadoop::daemon_nodemanager') -%>echo "nodemanager $1"; service <%= scope.lookupvar('hadoop::daemons')['nodemanager'] -%> $1<%end%>
		<%if scope.lookupvar('hadoop::daemon_datanode') -%>echo "datanode $1"; service <%= scope.lookupvar('hadoop::daemons')['datanode'] -%> $1<%end%>
		;;
	esac

	shift
done
